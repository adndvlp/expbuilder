<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png+xml" href="/icon/fp black.png">
    <title>Experiment</title>

    <link href="../jspsych-bundle/index.css" rel="stylesheet" type="text/css">
    <script src="../jspsych-bundle/index.js"></script>

    <style>
      body {
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
      }
      #jspsych-container {
        width: 100%;
        height: 100vh;
      }
      #jspsych-target {
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div id="jspsych-container">
      <div id="jspsych-target"></div>
    </div>

    
  

<script id="generated-script">


        const trialSessionId =
            "New Trial 2_result_" + (crypto.randomUUID
              ? crypto.randomUUID()
              : Math.random().toString(36).slice(2, 10));

        let participantNumber;

          async function saveSession(trialSessionId) {
          const res = await fetch("/api/append-result/a4ee1f3a-af44-4a81-992e-2ca1d2b4734b", {
            method: "POST",
            headers: { "Content-Type": "application/json", Accept: "*/*" },
            body: JSON.stringify({
              sessionId: trialSessionId,
            }),
          });

          const result = await res.json();
          participantNumber = result.participantNumber;
          return participantNumber;
    }
(async () => {
localStorage.removeItem('jsPsych_jumpToTrial');
  participantNumber = await saveSession(trialSessionId);

  if (typeof participantNumber !== "number" || isNaN(participantNumber)) {
    alert("The participant number is not assigned. Please, wait.");
    throw new Error("participantNumber not assigned");
  }
    const jsPsych = initJsPsych({
    display_element: document.getElementById('jspsych-container'),
          on_data_update: function (data) {
            const res = fetch("/api/append-result/a4ee1f3a-af44-4a81-992e-2ca1d2b4734b", {
              method: "PUT",
              headers: { "Content-Type": "application/json", Accept: "*/*" },
              body: JSON.stringify({
                sessionId: trialSessionId,
                response: data,
              }),
            });
        
          },

          on_finish: function() {
              jsPsych.data.displayData();
          },
    });

      const timeline = [];

      const welcome = {
        type: jsPsychHtmlButtonResponse,
        stimulus: "Trial Preview",
        choices: ['View'],
      };

      timeline.push(welcome);

      
      
    const test_stimuli_New_Trial_2 = [{components: [{ type: "ImageComponent", coordinates: {"x":0.115234375,"y":-0.5703125}, width: "50", height: 300, stimulus: "uploads/bqkjlm-experiment/img/boat.png" }],
response_components: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["hola"], rotation: 0 }],
stimuli_duration: undefined,
trial_duration: undefined,
response_ends_trial: undefined,
responses: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["hola"], rotation: 0 }]},{components: [{ type: "ImageComponent", coordinates: {"x":0.115234375,"y":-0.5703125}, width: "60", height: 300, stimulus: "uploads/bqkjlm-experiment/img/boat2.png" }],
response_components: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["como"], rotation: 0 }],
stimuli_duration: undefined,
trial_duration: undefined,
response_ends_trial: undefined,
responses: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["como"], rotation: 0 }]},{components: [{ type: "ImageComponent", coordinates: {"x":0.115234375,"y":-0.5703125}, width: "70", height: 300, stimulus: "uploads/bqkjlm-experiment/img/cube.png" }],
response_components: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["est"], rotation: 0 }],
stimuli_duration: undefined,
trial_duration: undefined,
response_ends_trial: undefined,
responses: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["est"], rotation: 0 }]},{components: [{ type: "ImageComponent", coordinates: {"x":0.115234375,"y":-0.5703125}, width: "50", height: 300, stimulus: "uploads/bqkjlm-experiment/img/floor.png" }],
response_components: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["as"], rotation: 0 }],
stimuli_duration: undefined,
trial_duration: undefined,
response_ends_trial: undefined,
responses: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["as"], rotation: 0 }]},{components: [{ type: "ImageComponent", coordinates: {"x":0.115234375,"y":-0.5703125}, width: "40", height: 300, stimulus: "uploads/bqkjlm-experiment/img/obstacle.png" }],
response_components: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["?"], rotation: 0 }],
stimuli_duration: undefined,
trial_duration: undefined,
response_ends_trial: undefined,
responses: [{ type: "ButtonResponseComponent", coordinates: {"x":0.572265625,"y":-0.5078125}, width: 200, height: 50, choices: ["?"], rotation: 0 }]}];
    const New_Trial_2_timeline = {
    type: DynamicPlugin, components: jsPsych.timelineVariable("components"),
response_components: jsPsych.timelineVariable("response_components"),
stimuli_duration: jsPsych.timelineVariable("stimuli_duration"),
trial_duration: jsPsych.timelineVariable("trial_duration"),
response_ends_trial: jsPsych.timelineVariable("response_ends_trial"),
      data: {
        stimulus: "stimulus",
response: "response",
rt: "rt",
        trial_id: 1763704862399,
        
        
      },
    on_start: function(trial) {
      // First, evaluate and apply params override conditions (if any)
      
      // Then apply custom parameters from branching conditions (higher priority)
      
      // For trials outside loops, use window.branchCustomParameters
      if (window.branchCustomParameters && typeof window.branchCustomParameters === 'object') {
        console.log('Applying custom parameters to trial:', window.branchCustomParameters);
        Object.entries(window.branchCustomParameters).forEach(([key, param]) => {
          if (param && param.source !== 'none') {
            // Handle different parameter sources
            if (param.source === 'typed' && param.value !== undefined && param.value !== null) {
              // For typed values, use them directly
              trial[key] = param.value;
              console.log(`Set trial.${key} = ${param.value}`);
            } else if (param.source === 'csv' && param.value !== undefined && param.value !== null) {
              // For CSV values, param.value contains the column name, get the actual value from trial
              trial[key] = trial[param.value];
              console.log(`Set trial.${key} = ${trial[param.value]} (from CSV column: ${param.value})`);
            }
          }
        });
        // Clear the custom parameters after applying them
        window.branchCustomParameters = null;
      }
      
    },
    
    on_finish: function(data) {
      // Este trial no tiene branches ni repeat conditions, es un trial terminal
      // Si llegamos aquí después de un branching, terminar el experimento
      if (window.branchingActive) {
        jsPsych.abortExperiment('', {});
      }
    },
    };
    const New_Trial_2_procedure = {
    timeline: 
    [New_Trial_2_timeline],
    timeline_variables: test_stimuli_New_Trial_2,
    conditional_function: function() {
      const currentId = 1763704862399;
      
      // Verificar si hay un trial objetivo guardado en localStorage (para repeat/jump)
      const jumpToTrial = localStorage.getItem('jsPsych_jumpToTrial');
      if (jumpToTrial) {
        if (String(currentId) === String(jumpToTrial)) {
          // Encontramos el trial objetivo para repeat/jump
          console.log('Repeat/jump: Found target trial', currentId);
          localStorage.removeItem('jsPsych_jumpToTrial');
          return true;
        }
        // No es el objetivo, saltar
        console.log('Repeat/jump: Skipping trial', currentId);
        return false;
      }
      
      // Si skipRemaining está activo (branching normal), verificar si este es el trial objetivo
      if (window.skipRemaining) {
        if (String(currentId) === String(window.nextTrialId)) {
          // Encontramos el trial objetivo
          window.skipRemaining = false;
          window.nextTrialId = null;
          return true;
        }
        // No es el objetivo, saltar
        return false;
      }
      
      return true;
    },
    
    };
    timeline.push(New_Trial_2_procedure);
  

    false

      jsPsych.run(timeline);
      
      })()
      
</script></body></html>